---
const languages = [
    { code: 'en', name: 'English', flag: 'https://flagpedia.net/data/flags/w580/us.png' },
    { code: 'pt-BR', name: 'Brazilian Portuguese', flag: 'https://flagpedia.net/data/flags/w580/br.png' },
    { code: 'ja', name: 'Japanese', flag: 'https://flagpedia.net/data/flags/w580/jp.png' },
    { code: 'es', name: 'Spanish', flag: 'https://flagpedia.net/data/flags/w580/es.png' },
    { code: 'zh', name: 'Chinese', flag: 'https://flagpedia.net/data/flags/w580/cn.png' },
];

let currentLangCode = 'en';
if (typeof Astro.cookies !== 'undefined') {
    const langCookie = Astro.cookies.get('language');
    if (langCookie && languages.some(l => l.code === langCookie.value)) {
        currentLangCode = langCookie.value;
    }
}
const currentLang = languages.find(l => l.code === currentLangCode) || languages[0];
---

<div class="language-switcher">
    <button id="language-switcher-button">
        <img src={currentLang.flag} alt={currentLang.name} class="flag-icon" />
        <span>{currentLang.name}</span>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="chevron-down">
            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
        </svg>
    </button>
    <div id="language-options" class="language-options">
        {languages.map(lang => (
            <a href="#" class="language-option" data-lang={lang.code}>
                <img src={lang.flag} alt={lang.name} class="flag-icon" />
                <span>{lang.name}</span>
            </a>
        ))}
    </div>
</div>

<style>
    .language-switcher {
        position: absolute;
        top: 1rem;
        right: 1rem;
        z-index: 10;
    }
    #language-switcher-button {
        display: flex;
        align-items: center;
        background-color: #374151;
        color: white;
        border: 1px solid #4B5563;
        border-radius: 0.25rem;
        padding: 0.5rem 0.75rem;
        cursor: pointer;
        font-family: inherit;
    }
    .flag-icon {
        width: 1.5rem;
        height: 1rem;
        margin-right: 0.5rem;
        border-radius: 0.125rem;
    }
    .chevron-down {
        width: 1.25rem;
        height: 1.25rem;
        margin-left: 0.5rem;
    }
    .language-options {
        display: none;
        position: absolute;
        top: 100%;
        right: 0;
        background-color: #374151;
        border: 1px solid #4B5563;
        border-radius: 0.25rem;
        padding: 0.5rem 0;
        margin-top: 0.25rem;
    }
    .language-options.show {
        display: block;
    }
    .language-option {
        display: flex;
        align-items: center;
        padding: 0.5rem 1rem;
        color: white;
        text-decoration: none;
    }
    .language-option:hover {
        background-color: #4B5563;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const button = document.getElementById('language-switcher-button');
        const options = document.getElementById('language-options');

        button.addEventListener('click', () => {
            options.classList.toggle('show');
        });

        document.addEventListener('click', (event) => {
            if (!button.contains(event.target) && !options.contains(event.target)) {
                options.classList.remove('show');
            }
        });

        const optionLinks = options.querySelectorAll('.language-option');
        optionLinks.forEach(link => {
            link.addEventListener('click', (event) => {
                event.preventDefault();
                const selectedLanguage = link.getAttribute('data-lang');
                localStorage.setItem('language', selectedLanguage);
                document.cookie = `language=${selectedLanguage};path=/`;
                window.location.reload();
            });
        });

        const savedLanguage = localStorage.getItem('language') || document.cookie.split('; ').find(row => row.startsWith('language='))?.split('=')[1];
        if (savedLanguage) {
            const currentLang = {
                'en': { name: 'English', flag: 'https://flagpedia.net/data/flags/w580/us.png' },
                'pt-BR': { name: 'Brazilian Portuguese', flag: 'https://flagpedia.net/data/flags/w580/br.png' },
                'ja': { name: 'Japanese', flag: 'https://flagpedia.net/data/flags/w580/jp.png' },
                'es': { name: 'Spanish', flag: 'https://flagpedia.net/data/flags/w580/es.png' },
                'zh': { name: 'Chinese', flag: 'https://flagpedia.net/data/flags/w580/cn.png' },
            }[savedLanguage];
            if (currentLang) {
                const buttonImg = button.querySelector('.flag-icon');
                const buttonSpan = button.querySelector('span');
                buttonImg.src = currentLang.flag;
                buttonImg.alt = currentLang.name;
                buttonSpan.textContent = currentLang.name;
            }
        }
    });
</script>
