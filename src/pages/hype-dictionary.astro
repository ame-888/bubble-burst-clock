---
import Layout from '../layouts/Layout.astro';
import en from '../locales/en.json';
import ptBR from '../locales/pt-BR.json';
import ja from '../locales/ja.json';
import es from '../locales/es.json';
import zh from '../locales/zh.json';

const translations = {
    'en': en,
    'pt-BR': ptBR,
    'ja': ja,
    'es': es,
    'zh': zh,
};

const lang = 'en';
const t = translations[lang];

const terms = ['agentic', 'agi', 'alignment', 'asi', 'chain_of_thought', 'collapse', 'graph_of_thought', 'hallucination', 'multimodality', 'prompt', 'reasoning_model', 'singularity', 'slop', 'token', 'transformer', 'tree_of_thought', 'ubi', 'world_model'];

// Hint logic: Wraps a specific letter in a span with 'secret-char' class
// "TRUTH"
// T: Transformer (first)
// R: Reasoning_model (first)
// U: Ubi (first)
// T: Token (first)
// H: Hallucination (first)

// Map term to { index: i, char: 'X' } where index is character index in the string
const secretMap = {
    'transformer': { char: 'T', pos: 0 },
    'reasoning_model': { char: 'R', pos: 0 },
    'ubi': { char: 'U', pos: 0 },
    'token': { char: 'T', pos: 0 },
    'hallucination': { char: 'H', pos: 0 }
};
---

<Layout lang={lang} title={`${t.hype_dictionary_title} - ${t.title}`}>
    <main>
        <h1 id="hype-title">{t.hype_dictionary_title}</h1>
        <div class="hype-container">
            <dl class="hype-list">
                {terms.map(term => (
                    <div class="hype-item">
                        <dt id={`term-${term}`} class="term-dt">{t[`hype_term_${term}`]}</dt>
                        <dd id={`def-${term}`}>{t[`hype_def_${term}`]}</dd>
                    </div>
                ))}
            </dl>
        </div>
    </main>
</Layout>

<style>
    main {
        max-width: 50rem;
        margin: 4rem auto;
        padding: 0 1rem;
    }

    h1 {
        font-size: 2.5rem;
        font-weight: 900;
        text-align: center;
        margin-bottom: 2rem;
        color: white;
        background: linear-gradient(to right, #8B5CF6, #C084FC);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .hype-container {
        background: rgba(31, 41, 55, 0.5);
        border: 1px solid rgba(139, 92, 246, 0.3);
        box-shadow: 0 0 30px rgba(139, 92, 246, 0.1);
        border-radius: 1rem;
        padding: 2.5rem;
    }

    .hype-list {
        display: flex;
        flex-direction: column;
        gap: 2rem;
        margin: 0;
    }

    .hype-item {
        padding-bottom: 2rem;
        border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .hype-item:last-child { border-bottom: none; padding-bottom: 0; }

    dt {
        font-size: 1.4rem;
        font-weight: 700;
        color: #A78BFA;
        margin-bottom: 0.75rem;
        font-family: 'Poppins', sans-serif;
    }

    dd {
        margin: 0;
        color: #D1D5DB;
        line-height: 1.6;
        font-size: 1.05rem;
    }

    /* Secret Character Style */
    :global(.secret-char) {
        color: #C4B5FD; /* Slightly lighter purple */
        text-shadow: 0 0 2px #fff;
        font-weight: 900;
    }
</style>

<script define:vars={{ translations, lang, terms, secretMap }}>
    function updateTranslations() {
        let currentLang = lang;
        try {
            currentLang = localStorage.getItem('language') || document.cookie.split('; ').find(row => row.startsWith('language='))?.split('=')[1] || lang;
        } catch (e) {
            console.warn('Language detection failed:', e);
        }

        const t = translations[currentLang] || translations['en'];

        const title = document.getElementById('hype-title');
        if (title) title.textContent = t.hype_dictionary_title;

        // Check achievement
        if (window.AchievementManager) {
            window.AchievementManager.unlock('scholar');
        } else {
             // Fallback if manager not loaded yet
             window.addEventListener('load', () => {
                 if (window.AchievementManager) window.AchievementManager.unlock('scholar');
             });
        }

        terms.forEach(term => {
            const dt = document.getElementById(`term-${term}`);
            const dd = document.getElementById(`def-${term}`);

            let termText = t[`hype_term_${term}`];
            const defText = t[`hype_def_${term}`];

            // Apply Hints
            if (dt && secretMap[term]) {
                // We need to carefully wrap the letter if it matches roughly
                // This is tricky with localization.
                // We only do this trick for English or if the letter exists in the translated term.

                // Simplified: Just highlight if found
                // T = prompt, R = reasoning, U = ubi, T = thought, H = hallucination

                // Logic: Find the character and wrap it
                const map = secretMap[term];
                let charToFind = map.char.toLowerCase();

                // Case insensitive search
                let idx = -1;
                if (map.pos === 'last') {
                    idx = termText.toLowerCase().lastIndexOf(charToFind);
                } else {
                    idx = termText.toLowerCase().indexOf(charToFind);
                }

                if (idx !== -1) {
                    const before = termText.substring(0, idx);
                    const match = termText.substring(idx, idx+1);
                    const after = termText.substring(idx+1);
                    dt.innerHTML = `${before}<span class="secret-char">${match}</span>${after}`;
                } else {
                    dt.textContent = termText;
                }
            } else if (dt) {
                dt.textContent = termText;
            }

            if (dd) dd.textContent = defText;
        });
    }

    document.addEventListener('DOMContentLoaded', updateTranslations);
</script>
