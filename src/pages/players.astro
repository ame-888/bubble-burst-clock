---
import Layout from '../layouts/Layout.astro';
import { predictions } from '../data/predictions';
import en from '../locales/en.json';
import ptBR from '../locales/pt-BR.json';
import ja from '../locales/ja.json';
import es from '../locales/es.json';
import zh from '../locales/zh.json';

const translations = {
    'en': en,
    'pt-BR': ptBR,
    'ja': ja,
    'es': es,
    'zh': zh,
};

const lang = 'en';
const t = translations[lang];

// --- Status Logic for counts ---
const now = new Date('2025-12-03T00:00:00Z');

const processedPredictions = predictions.map(p => {
    let status = 'FUTURE PREDICTION';
    const start = p.validityStart ? new Date(p.validityStart) : null;
    const end = p.validityEnd ? new Date(p.validityEnd) : null;

    if (start && end) {
        if (now < start) {
            status = 'FUTURE PREDICTION';
        } else if (now >= start && now <= end) {
            status = 'ACTIVE';
        } else {
            status = 'EXPIRED';
        }
    }
    return { ...p, status };
});

// --- Player Cards Logic ---
const creatorsData = {};
processedPredictions.forEach(p => {
    if (!creatorsData[p.creator]) {
        creatorsData[p.creator] = {
            name: p.creator,
            total: 0,
            failures: 0,
            pending: 0,
            successes: 0,
            predictions: []
        };
    }
    creatorsData[p.creator].total++;
    creatorsData[p.creator].predictions.push(p);

    if (p.status === 'EXPIRED') {
        creatorsData[p.creator].failures++;
    } else if (p.status === 'ACTIVE' || p.status === 'FUTURE PREDICTION') {
        creatorsData[p.creator].pending++;
    } else {
        creatorsData[p.creator].successes++;
    }
});

// Deterministic RPG Stats Generator
function getRPGStats(name) {
    let hash = 0;
    for (let i = 0; i < name.length; i++) {
        hash = name.charCodeAt(i) + ((hash << 5) - hash);
    }
    const rng = (seed) => {
        const x = Math.sin(seed) * 10000;
        return Math.floor((Math.abs(x - Math.floor(x))) * 100); // 0-99
    };
    const scale = (val) => 10 + Math.floor(val * 0.89);

    return {
        STR: scale(rng(hash)),
        INT: scale(rng(hash + 1)),
        CHA: scale(rng(hash + 2)),
        LUCK: scale(rng(hash + 3))
    };
}

const players = Object.values(creatorsData).map(c => {
    // @ts-ignore
    const stats = getRPGStats(c.name);
    // Success Rate: (Success / (Success + Failure)) * 100. If 0 completed, 0%.
    // @ts-ignore
    const completed = c.successes + c.failures;
    // @ts-ignore
    const successRate = completed > 0 ? ((c.successes / completed) * 100).toFixed(0) : 0;

    // Assign a "Class" based on stats or name
    let rpgClass = "Doomer"; // Default
    if (stats.INT > 85) rpgClass = "Technomancer";
    else if (stats.CHA > 85) rpgClass = "Cult Leader";
    else if (stats.STR > 85) rpgClass = "Bubble Burster";
    else if (stats.LUCK > 85) rpgClass = "Oracle";

    // Rarity Map
    const rarityMap = {
        "Gary Marcus": "Legendary",
        "O Primo Rico": "Legendary",
        "Sabine Hossenfelder": "Legendary",
        "Adam Conover": "Epic",
        "Brianne Worth": "Epic",
        "Cole Hastings": "Epic",
        "Man Carrying Thing": "Epic",
        "Georg Rockall-Schmidt": "Epic",
        "Sasha Yanshin": "Epic",
        "OverEasy": "Rare",
        "Shade of Code": "Rare"
    };

    // @ts-ignore
    const rarity = rarityMap[c.name] || "Common";

    // MTG Color Mapping
    let mtgColor = "white"; // Doomer/Default
    if (rpgClass === "Technomancer") mtgColor = "blue";
    else if (rpgClass === "Cult Leader") mtgColor = "black";
    else if (rpgClass === "Bubble Burster") mtgColor = "red";
    else if (rpgClass === "Oracle") mtgColor = "green";

    // Flavor Text
    const flavorTextMap = {
        "Technomancer": "Logic is a prison waiting to be broken.",
        "Cult Leader": "Belief is the only currency that matters.",
        "Bubble Burster": "Reality has a way of asserting itself.",
        "Oracle": "I see what you refuse to acknowledge.",
        "Doomer": "The end is not near, it is here."
    };
    const flavorText = flavorTextMap[rpgClass] || "A watcher of the bubble.";

    // Last Entry Date (for sorting)
    const latestDate = Math.max(...c.predictions.map(p => {
        const d = p.uploadDate ? new Date(p.uploadDate) : new Date(0);
        return d.getTime();
    }));

    return { ...c, stats, successRate, rpgClass, rarity, mtgColor, flavorText, latestDate };
    // @ts-ignore
}).sort((a, b) => b.total - a.total); // Default sort
---

<Layout lang={lang} title={`${t.player_cards_title} - ${t.title}`}>
    <main>
        <h1 id="player-cards-title">{t.player_cards_title}</h1>

        <!-- Sorting Controls -->
        <div class="sort-controls">
            <label for="sort-select" class="sort-label">Sort by:</label>
            <select id="sort-select" class="sort-select">
                <option value="famous_desc">Most Famous</option>
                <option value="famous_asc">Least Famous</option>
                <option value="date_desc">Latest Entry</option>
                <option value="date_asc">Oldest Entry</option>
            </select>
        </div>

        <div class="player-container">
            <!-- Grid View -->
            <div id="player-grid-view" class="">
                <div class="player-grid" id="player-grid-container">
                    {players.map(player => (
                        <div class="player-card-mini"
                             data-player-name={player.name}
                             data-rarity={player.rarity}
                             data-latest-date={player.latestDate}>
                            <div class="player-avatar-mini">{player.name.substring(0, 2).toUpperCase()}</div>
                            <div class="player-info-mini">
                                <div class="player-name-mini">{player.name}</div>
                                <div class="player-class-mini">{player.rpgClass}</div>
                            </div>
                            <div class="player-stats-mini">
                                <div class="stat-badge">LVL {player.total}</div>
                            </div>
                        </div>
                    ))}
                </div>
            </div>

            <!-- Detail View -->
            <div id="player-detail-view" class="hidden">
                <div class="detail-nav">
                    <button id="back-to-grid" class="back-button">← Back</button>
                    <div class="nav-arrows">
                         <button id="prev-card" class="nav-arrow" aria-label="Previous">←</button>
                         <button id="next-card" class="nav-arrow" aria-label="Next">→</button>
                    </div>
                </div>

                <div class="mtg-card-container" id="mtg-card-container">
                    <!-- Dynamic classes for color/rarity will be added here via JS -->
                    <div class="mtg-card-border">
                        <div class="mtg-card-content">
                            <!-- Header -->
                            <div class="mtg-header">
                                <span id="detail-name" class="mtg-card-name">Player Name</span>
                                <span id="detail-mana" class="mtg-mana-cost"></span>
                            </div>

                            <!-- Art -->
                            <div class="mtg-art-frame">
                                <div class="mtg-art-inner">
                                    <div class="rpg-avatar" id="detail-avatar"></div>
                                </div>
                            </div>

                            <!-- Type Line -->
                            <div class="mtg-type-line">
                                <span id="detail-type-text">Legendary Creature — Class</span>
                                <div id="detail-set-symbol" class="mtg-set-symbol"></div>
                            </div>

                            <!-- Text Box -->
                            <div class="mtg-text-box">
                                <ul id="detail-predictions-list" class="mtg-abilities-list">
                                    <!-- Populated by JS -->
                                </ul>
                                <div class="mtg-flavor-separator"></div>
                                <div id="detail-flavor" class="mtg-flavor-text">
                                    "Flavor text goes here."
                                </div>
                            </div>

                            <!-- Footer -->
                            <div class="mtg-footer">
                                <div class="mtg-pt-box">
                                    <span id="detail-pt">0 / 0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</Layout>

<style>
    main {
        max-width: 80rem;
        margin: 4rem auto;
        padding: 0 1rem;
    }

    h1 {
        font-size: 3rem;
        font-weight: 900;
        text-align: center;
        margin-bottom: 2rem;
        color: white;
        background: linear-gradient(to right, #10B981, #059669);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .player-container {
        /* No container background for grid to let cards pop, but maybe needed for contrast?
           Let's keep it clean like the modal was */
    }

    /* Grid View */
    .sort-controls {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 2rem;
        gap: 1rem;
    }

    .sort-label {
        color: #D1D5DB;
        font-weight: 600;
    }

    .sort-select {
        background: rgba(31, 41, 55, 0.8);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        cursor: pointer;
        font-family: 'Inter', sans-serif;
    }

    .player-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 1.5rem;
        margin-top: 1.5rem;
    }

    .player-card-mini {
        background: rgba(31, 41, 55, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 1rem;
        padding: 1.5rem;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        position: relative;
        overflow: hidden;
    }

    .player-card-mini:hover {
        background: rgba(55, 65, 81, 0.8);
        border-color: #10B981;
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
    }

    .player-card-mini::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: linear-gradient(90deg, #10B981, #3B82F6);
        opacity: 0.7;
    }

    /* Rarity Specific Styles for Grid */
    :global(.player-card-mini[data-rarity="Legendary"]) {
        border-color: #FF4500;
        box-shadow: 0 0 15px rgba(255, 69, 0, 0.2);
    }
    :global(.player-card-mini[data-rarity="Legendary"]::before) {
        background: linear-gradient(90deg, #FFD700, #FF4500);
    }

    :global(.player-card-mini[data-rarity="Epic"]) {
        border-color: #9932CC;
        box-shadow: 0 0 10px rgba(153, 50, 204, 0.2);
    }
    :global(.player-card-mini[data-rarity="Epic"]::before) {
        background: linear-gradient(90deg, #DA70D6, #9932CC);
    }

    :global(.player-card-mini[data-rarity="Rare"]) {
        border-color: #C0C0C0;
    }
    :global(.player-card-mini[data-rarity="Rare"]::before) {
        background: linear-gradient(90deg, #E5E7EB, #9CA3AF);
    }

    .player-avatar-mini {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: #1F2937;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 900;
        font-size: 1.5rem;
        color: #10B981;
        margin-bottom: 0.75rem;
        border: 2px solid rgba(255, 255, 255, 0.1);
    }

    .player-info-mini {
        margin-bottom: 0.75rem;
    }

    .player-name-mini {
        font-weight: 700;
        font-size: 1.1rem;
        color: white;
        margin-bottom: 0.25rem;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        max-width: 150px;
    }

    .player-class-mini {
        font-size: 0.8rem;
        color: #9CA3AF;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .stat-badge {
        background: rgba(16, 185, 129, 0.2);
        color: #34D399;
        font-size: 0.8rem;
        padding: 0.25rem 0.75rem;
        border-radius: 1rem;
        font-weight: 600;
    }

    /* Detail View (MTG Style) */
    .hidden { display: none !important; }

    .detail-nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        width: 100%;
        max-width: 400px;
        margin-left: auto;
        margin-right: auto;
    }

    .back-button, .nav-arrow {
        background: rgba(31, 41, 55, 0.8);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.2s;
    }

    .back-button:hover, .nav-arrow:hover {
        background: rgba(55, 65, 81, 0.8);
        border-color: #60A5FA;
    }

    .nav-arrows {
        display: flex;
        gap: 0.5rem;
    }

    /* MTG Card Styles (Reused) */
    .mtg-card-container {
        width: 100%;
        max-width: 400px;
        margin: 0 auto;
        font-family: 'Times New Roman', serif;
        position: relative;
        border-radius: 15px;
        padding: 10px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }

    /* Colors */
    .mtg-card-container.white { background: #E0E0E0; }
    .mtg-card-container.blue { background: #A0C0E0; }
    .mtg-card-container.black { background: #404040; }
    .mtg-card-container.red { background: #E08080; }
    .mtg-card-container.green { background: #90C090; }

    .mtg-card-border {
        background: #111;
        border-radius: 10px;
        padding: 4px; /* Inner black border */
        height: 100%;
    }

    /* Rarity Borders */
    .mtg-card-container.common .mtg-card-border { border: 2px solid #000; }
    .mtg-card-container.rare .mtg-card-border { border: 2px solid #C0C0C0; box-shadow: 0 0 10px silver; }
    .mtg-card-container.epic .mtg-card-border { border: 2px solid #FFD700; box-shadow: 0 0 15px gold; }
    .mtg-card-container.legendary .mtg-card-border {
        border: 4px double #FF4500;
        box-shadow: 0 0 20px rgba(255, 69, 0, 0.6);
        clip-path: polygon(
            5% 0%, 95% 0%, 100% 5%, 100% 95%, 95% 100%, 5% 100%, 0% 95%, 0% 5%
        );
    }

    .mtg-card-content {
        background: #e6e6e6; /* Default card face */
        border-radius: 8px;
        padding: 0.5rem;
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
        height: 100%;
    }
    /* Inner Face Colors (slightly lighter than border) */
    .mtg-card-container.white .mtg-card-content { background: #F8F8F8; }
    .mtg-card-container.blue .mtg-card-content { background: #C8D8E8; }
    .mtg-card-container.black .mtg-card-content { background: #B0B0B0; }
    .mtg-card-container.red .mtg-card-content { background: #F0C0C0; }
    .mtg-card-container.green .mtg-card-content { background: #C8E8C8; }

    /* Header */
    .mtg-header {
        border: 2px solid #888;
        background: rgba(255,255,255,0.4);
        border-radius: 15px 15px 0 0;
        padding: 0.25rem 0.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
    }
    .mtg-card-name {
        font-weight: 700;
        font-size: 1.1rem;
        color: #000;
    }
    .mtg-mana-cost {
        font-weight: 700;
        color: #333;
        font-size: 0.9rem;
        background: rgba(255,255,255,0.5);
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px solid #666;
    }

    /* Art */
    .mtg-art-frame {
        background: #000;
        padding: 2px;
        margin: 0.1rem 0;
        border: 1px solid #555;
    }
    .mtg-art-inner {
        background: #333;
        height: 180px;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        position: relative;
    }
    /* Reuse the avatar styling but larger */
    .rpg-avatar {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: #374151;
        border: 3px solid #FFF;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
        font-weight: 900;
        color: white;
        z-index: 1;
        box-shadow: 0 0 20px rgba(0,0,0,0.5);
    }

    /* Type Line */
    .mtg-type-line {
        border: 2px solid #888;
        background: rgba(255,255,255,0.4);
        padding: 0.25rem 0.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.9rem;
        font-weight: 700;
        color: #000;
        box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
    }

    .mtg-set-symbol {
        font-size: 1.2rem;
    }
    .mtg-card-container.common .mtg-set-symbol::after { content: '●'; color: black; }
    .mtg-card-container.rare .mtg-set-symbol::after { content: '★'; color: gold; text-shadow: 0 0 2px black; }
    .mtg-card-container.epic .mtg-set-symbol::after { content: '◆'; color: #9932CC; text-shadow: 0 0 2px black; }
    .mtg-card-container.legendary .mtg-set-symbol::after { content: '♛'; color: #FF4500; text-shadow: 0 0 3px yellow; }

    /* Text Box */
    .mtg-text-box {
        border: 2px solid #888;
        background: rgba(255,255,255,0.7);
        padding: 0.5rem;
        flex: 1;
        font-size: 0.85rem;
        color: #000;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        min-height: 150px;
    }

    .mtg-abilities-list {
        list-style: none;
        padding: 0;
        margin: 0;
        flex: 1;
    }
    /* .mtg-abilities-list li styled globally in JS or below */
    :global(.mtg-abilities-list li) {
        margin-bottom: 0.4rem;
        line-height: 1.3;
        display: flex;
        gap: 0.5rem;
    }

    .mtg-ability-bullet {
        font-weight: bold;
        margin-right: 4px;
    }
    .bullet-future { color: #3B82F6; }
    .bullet-active { color: #10B981; }
    .bullet-expired { color: #EF4444; }

    .mtg-flavor-separator {
        height: 1px;
        background: #000;
        opacity: 0.2;
        margin: 0.25rem 0;
    }

    .mtg-flavor-text {
        font-style: italic;
        font-size: 0.8rem;
        opacity: 0.8;
    }

    /* Footer / P/T */
    .mtg-footer {
        display: flex;
        justify-content: flex-end;
        margin-top: -10px; /* Overlap text box slightly */
        z-index: 10;
        position: relative;
    }
    .mtg-pt-box {
        background: #e6e6e6;
        border: 2px solid #888;
        padding: 0.2rem 0.6rem;
        border-radius: 10px;
        font-weight: 700;
        font-size: 1rem;
        color: #000;
        box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
    }
    .mtg-card-container.black .mtg-pt-box { background: #B0B0B0; }
    .mtg-card-container.blue .mtg-pt-box { background: #C8D8E8; }

</style>

<script define:vars={{ translations, lang, players }}>
    // We need to inject the logic to handle the card interactions here
    // It is almost identical to the modal logic but scoped to this page

    function init() {
        let currentLang = lang;
        try {
            currentLang = localStorage.getItem('language') || document.cookie.split('; ').find(row => row.startsWith('language='))?.split('=')[1] || lang;
        } catch (e) {
            console.warn('Language detection failed:', e);
        }

        const t = translations[currentLang] || translations['en'];

        // Update title if needed
        const title = document.getElementById('player-cards-title');
        if (title) title.textContent = t.player_cards_title;

        // Interaction Logic
        const gridView = document.getElementById('player-grid-view');
        const detailView = document.getElementById('player-detail-view');
        const backBtn = document.getElementById('back-to-grid');
        const gridContainer = document.getElementById('player-grid-container');
        const sortSelect = document.getElementById('sort-select');
        const prevBtn = document.getElementById('prev-card');
        const nextBtn = document.getElementById('next-card');

        let currentSortedPlayers = [...players];
        let currentIndex = -1;

        // Rarity Priority Map for Sorting
        const rarityVal = { "Legendary": 4, "Epic": 3, "Rare": 2, "Common": 1 };

        function updateGrid() {
            if (!gridContainer) return;
            gridContainer.innerHTML = '';

            // Re-render based on sorted list
            currentSortedPlayers.forEach(player => {
                const div = document.createElement('div');
                div.className = 'player-card-mini';
                div.dataset.playerName = player.name;
                div.dataset.rarity = player.rarity; // Ensure rarity is set on re-render
                div.innerHTML = `
                    <div class="player-avatar-mini">${player.name.substring(0, 2).toUpperCase()}</div>
                    <div class="player-info-mini">
                        <div class="player-name-mini">${player.name}</div>
                        <div class="player-class-mini">${player.rpgClass}</div>
                    </div>
                    <div class="player-stats-mini">
                        <div class="stat-badge">LVL ${player.total}</div>
                    </div>
                `;
                div.addEventListener('click', () => openDetail(player.name));
                gridContainer.appendChild(div);
            });
        }

        function sortPlayers(mode) {
            if (mode === 'famous_desc') {
                currentSortedPlayers.sort((a, b) => (rarityVal[b.rarity] || 1) - (rarityVal[a.rarity] || 1));
            } else if (mode === 'famous_asc') {
                currentSortedPlayers.sort((a, b) => (rarityVal[a.rarity] || 1) - (rarityVal[b.rarity] || 1));
            } else if (mode === 'date_desc') {
                currentSortedPlayers.sort((a, b) => b.latestDate - a.latestDate);
            } else if (mode === 'date_asc') {
                currentSortedPlayers.sort((a, b) => a.latestDate - b.latestDate);
            }
            updateGrid();
        }

        if (sortSelect) {
            sortSelect.addEventListener('change', (e) => sortPlayers(e.target.value));
            // Initial sort
            sortPlayers(sortSelect.value);
        }

        function openDetail(name) {
             const index = currentSortedPlayers.findIndex(p => p.name === name);
             if (index === -1) return;
             currentIndex = index;
             renderDetail(currentSortedPlayers[currentIndex]);

             gridView.classList.add('hidden');
             detailView.classList.remove('hidden');
        }

        function renderDetail(player) {
            // Populate Detail View (MTG Style)
            const dName = document.getElementById('detail-name');
            if (dName) dName.textContent = player.name;

            const dType = document.getElementById('detail-type-text');
            if (dType) dType.textContent = `${player.rarity} ${player.rpgClass}`;

            const dMana = document.getElementById('detail-mana');
            if (dMana) dMana.textContent = player.total;

            const dAvatar = document.getElementById('detail-avatar');
            if (dAvatar) dAvatar.textContent = player.name.substring(0, 2).toUpperCase();

            const dPt = document.getElementById('detail-pt');
            if (dPt) dPt.textContent = `${player.successes}/${player.total}`;

            const dFlavor = document.getElementById('detail-flavor');
            if (dFlavor) dFlavor.textContent = `"${player.flavorText}"`;

            // Update Lists
            const list = document.getElementById('detail-predictions-list');
            if (list) {
                list.innerHTML = '';
                player.predictions.forEach(p => {
                    const li = document.createElement('li');

                    // Localize claim if object
                    let claimText = '';
                    if (typeof p.claim === 'string') claimText = p.claim;
                    else if (typeof p.claim === 'object') claimText = p.claim[currentLang] || p.claim['en'];

                    let bulletColorClass = 'bullet-future';
                    if (p.status === 'ACTIVE') bulletColorClass = 'bullet-active';
                    if (p.status === 'EXPIRED') bulletColorClass = 'bullet-expired';

                    // Use a colored bullet point instead of text label
                    li.innerHTML = `<span class="mtg-ability-bullet ${bulletColorClass}">●</span> <span>${claimText}</span>`;
                    list.appendChild(li);
                });
            }

            // Apply Styles
            const container = document.getElementById('mtg-card-container');
            if (container) {
                container.className = 'mtg-card-container'; // Reset
                container.classList.add(player.mtgColor.toLowerCase());
                container.classList.add(player.rarity.toLowerCase());
            }
        }

        if (backBtn && gridView && detailView) {
            backBtn.addEventListener('click', () => {
                detailView.classList.add('hidden');
                gridView.classList.remove('hidden');
            });
        }

        if (prevBtn) {
            prevBtn.addEventListener('click', () => {
                if (currentIndex > 0) {
                    currentIndex--;
                    renderDetail(currentSortedPlayers[currentIndex]);
                } else {
                    // Loop to end
                    currentIndex = currentSortedPlayers.length - 1;
                    renderDetail(currentSortedPlayers[currentIndex]);
                }
            });
        }

        if (nextBtn) {
            nextBtn.addEventListener('click', () => {
                if (currentIndex < currentSortedPlayers.length - 1) {
                    currentIndex++;
                    renderDetail(currentSortedPlayers[currentIndex]);
                } else {
                    // Loop to start
                    currentIndex = 0;
                    renderDetail(currentSortedPlayers[currentIndex]);
                }
            });
        }
    }

    document.addEventListener('DOMContentLoaded', init);
</script>
